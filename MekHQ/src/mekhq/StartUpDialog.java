/*
 * StartUpDialog.java
 *
 * Created on Jan 6, 2010, 10:46:02 PM
 */

package mekhq;

import java.awt.Dimension;
import java.awt.Frame;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.GridLayout;
import java.awt.Image;
import java.awt.Insets;
import java.awt.MediaTracker;
import java.io.File;
import java.io.FileInputStream;

import javax.swing.ImageIcon;
import javax.swing.JFileChooser;
import javax.swing.JLabel;
import javax.swing.filechooser.FileFilter;

import org.jdesktop.application.SingleFrameApplication;

import megamek.common.MechSummaryCache;
import mekhq.campaign.Campaign;
import mekhq.campaign.Planets;

/**
 *
 * @author Jay
 */
public class StartUpDialog extends javax.swing.JDialog {

	
	private static final long serialVersionUID = 8376874926997734492L;
	SingleFrameApplication app;
	/** Creates new form */
    public StartUpDialog(SingleFrameApplication app) {
        super(app.getMainFrame(), true);
        this.app = app;
        initComponents();      
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {


        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setName("Form"); // NOI18N

        setTitle("MekHQ");
        
        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(mekhq.MekHQApp.class).getContext().getResourceMap(StartUpDialog.class);
        
        btnNewGame = new javax.swing.JButton("Start a New Campaign");
        btnNewGame.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
            	loadCampaign(false);  	
            }
        });
        btnLoadGame = new javax.swing.JButton("Load a Campaign");
        btnLoadGame.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
            	loadCampaign(true);  	
            }
        });
        btnQuit = new javax.swing.JButton("Quit");
        btnQuit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                System.exit(0);
            }
        });
        
        // initialize splash image
        Image imgSplash = app.getMainFrame().getToolkit().getImage("data/images/misc/mekhq-splash.png"); //$NON-NLS-1$

        // wait for splash image to load completely
        MediaTracker tracker = new MediaTracker(app.getMainFrame());
        tracker.addImage(imgSplash, 0);
        try {
            tracker.waitForID(0);
        } catch (InterruptedException e) {
            // really should never come here
        }
        // make splash image panel
        ImageIcon icon = new ImageIcon(imgSplash);
        GridBagLayout gridbag = new GridBagLayout();
        GridBagConstraints c = new GridBagConstraints();
        getContentPane().setLayout(gridbag);
        c.anchor = GridBagConstraints.NORTHWEST;
        c.insets = new Insets(5, 5, 5, 5);
        c.gridx = 0;
        c.gridy = 0;
        c.fill = GridBagConstraints.NONE;
        c.weightx = 0.0;
        c.weighty = 0.0;
        c.gridwidth = 1;
        c.gridheight = 3;
        getContentPane().add(new JLabel(icon), c);
        c.gridx = 1;
        c.gridheight = 1;
        c.weightx = 1.0;
        c.weighty = 1.0;
        c.fill = GridBagConstraints.BOTH;
        c.anchor = GridBagConstraints.NORTHWEST;
        c.gridy = 0;
        getContentPane().add(btnNewGame,c);
        c.gridy++;
        getContentPane().add(btnLoadGame,c);
        c.gridy++;
        getContentPane().add(btnQuit,c);
        
        pack();
    }

    private void loadCampaign(boolean loadCampaign) {
    	File f = null;
    	if(loadCampaign) {
    		f = selectLoadCampaignFile();
    		if(null == f) {
    			return;
    		}
    	}
    	setVisible(false);
    	DataLoadingDialog dataLoadingDialog = new DataLoadingDialog(app, f);   	
    	dataLoadingDialog.setVisible(true);
    }
    
    private File selectLoadCampaignFile() {
		JFileChooser loadCpgn = new JFileChooser(".");
		loadCpgn.setDialogTitle("Load Campaign");
		loadCpgn.setFileFilter(new ExtFileFilter(".xml"));
		int returnVal = loadCpgn.showOpenDialog(app.getMainFrame());

		if ((returnVal != JFileChooser.APPROVE_OPTION)
				|| (loadCpgn.getSelectedFile() == null)) {
			// I want a file, y'know!
			return null;
		}
		
		File file = loadCpgn.getSelectedFile();

		return file;
	}
    
    class ExtFileFilter extends FileFilter {
		private String useExt = null;

		public ExtFileFilter(String ext) {
			useExt = ext;
		}

		@Override
		public boolean accept(File dir) {
			if (dir.isDirectory()) {
				return true;
			}
			return dir.getName().endsWith(useExt);
		}

		@Override
		public String getDescription() {
			return "campaign file (" + useExt + ")";
		}
	}
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnNewGame;
    private javax.swing.JButton btnLoadGame;
    private javax.swing.JButton btnQuit;
    // End of variables declaration//GEN-END:variables

}
