/*
 * StartUpDialog.java
 *
 * Created on Jan 6, 2010, 10:46:02 PM
 */

package mekhq;

import java.awt.Frame;
import java.awt.GridLayout;
import java.io.File;
import java.io.FileInputStream;

import javax.swing.JFileChooser;
import javax.swing.filechooser.FileFilter;

import org.jdesktop.application.SingleFrameApplication;

import megamek.common.MechSummaryCache;
import mekhq.campaign.Campaign;
import mekhq.campaign.Planets;

/**
 *
 * @author Jay
 */
public class StartUpDialog extends javax.swing.JDialog {

	
	private static final long serialVersionUID = 8376874926997734492L;
	SingleFrameApplication app;
	/** Creates new form */
    public StartUpDialog(SingleFrameApplication app) {
        super(app.getMainFrame(), true);
        this.app = app;
        initComponents();      
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {


        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setName("Form"); // NOI18N

        org.jdesktop.application.ResourceMap resourceMap = org.jdesktop.application.Application.getInstance(mekhq.MekHQApp.class).getContext().getResourceMap(StartUpDialog.class);
        
        btnNewGame = new javax.swing.JButton("Start a New Campaign");
        btnNewGame.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
            	setVisible(false);
            	loadCampaign(false);  	
            }
        });
        btnLoadGame = new javax.swing.JButton("Load a Campaign");
        btnLoadGame.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
            	setVisible(false);
            	loadCampaign(true);  	
            }
        });
        btnQuit = new javax.swing.JButton("Quit");
        btnQuit.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                System.exit(0);
            }
        });
        
        getContentPane().setLayout(new GridLayout(3, 0));
        getContentPane().add(btnNewGame);
        getContentPane().add(btnLoadGame);
        getContentPane().add(btnQuit);

     
        pack();
    }

    private void loadCampaign(boolean loadCampaign) {
    	File f = null;
    	if(loadCampaign) {
    		f = selectLoadCampaignFile();
    	}
    	DataLoadingDialog dataLoadingDialog = new DataLoadingDialog(app, f);   	
    	dataLoadingDialog.setVisible(true);
    }
    
    private File selectLoadCampaignFile() {
		JFileChooser loadCpgn = new JFileChooser(".");
		loadCpgn.setDialogTitle("Load Campaign");
		loadCpgn.setFileFilter(new ExtFileFilter(".xml"));
		int returnVal = loadCpgn.showOpenDialog(app.getMainFrame());

		if ((returnVal != JFileChooser.APPROVE_OPTION)
				|| (loadCpgn.getSelectedFile() == null)) {
			// I want a file, y'know!
			return null;
		}
		
		File file = loadCpgn.getSelectedFile();

		return file;
	}
    
    class ExtFileFilter extends FileFilter {
		private String useExt = null;

		public ExtFileFilter(String ext) {
			useExt = ext;
		}

		@Override
		public boolean accept(File dir) {
			if (dir.isDirectory()) {
				return true;
			}
			return dir.getName().endsWith(useExt);
		}

		@Override
		public String getDescription() {
			return "campaign file (" + useExt + ")";
		}
	}
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnNewGame;
    private javax.swing.JButton btnLoadGame;
    private javax.swing.JButton btnQuit;
    // End of variables declaration//GEN-END:variables

}
